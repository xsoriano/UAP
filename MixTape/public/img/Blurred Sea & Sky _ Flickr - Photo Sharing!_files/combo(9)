YUI.add("flickr-collection",function(e){var t={},n;n=e.FlickrCollection=function(e,t,n){this.registry=e,this.id=t,this.attrName=n,this._data=[],this.fetchedStart=!1,this.fetchedEnd=!1,this.totalItems=Number.MAX_VALUE},n.prototype={constructor:n,push:function(e){var t=this._data.concat();t.push(e),this.registry.setValue(this.id,this.attrName,t)},unshift:function(e){var t=this._data.concat();t.unshift(e),this.registry.setValue(this.id,this.attrName,t)},concat:function(e){var t=this._data.concat(e);this.registry.setValue(this.id,this.attrName,t)},remove:function(e){typeof e=="string"&&(e={id:e});var t=this.find(e,!0),n;return t&&(n=this._data.concat(),n.splice(t.index,1),this.registry.setValue(this.id,this.attrName,n)),t&&t.value},find:function(e,t){if(!e)return null;var n=null,r=Object.keys(e);return this._data.some(function(t,i){if(!t)return;if(r.every(function(n){return t[n]===e[n]}))return n={value:t,index:i},!0}),t?n:n?n.value:null},getFirstItem:function(){var e,t;for(e=0;e<this._data.length;e++){t=this._data[e];if(t)return{item:t,index:e}}return null},getLastItem:function(){var e,t;for(e=this._data.length-1;e>=0;e--){t=this._data[e];if(t)return{item:t,index:e}}return null},getList:function(){return this._data.concat()},size:function(){return this._data.length},toJSON:function(){var t=[];return e.Array.each(this.getList(),function(e){e&&t.push(e.toJSON())}),t},toString:function(){return this.registry.name+'["'+this.attrName+'"]'},appendToListMulti:function(e){this.concat(e)},appendToList:function(e){this.push(e)},prependToList:function(e){this.unshift(e)},getFromListByID:function(e,t){var n={},r;return n[t||"id"]=e,r=this.find(n),r?r:undefined},removeFromList:function(e,t){var n={};return n[t||"id"]=e,this.remove(n)},hasMinBoundary:function(){return this.fetchedStart},hasMaxBoundary:function(){return this.fetchedEnd},_setValue:function(e){this._data=e}},e.FlickrCollection.executeFetch=function(n,r,i,s){var o,u;return!s||!e.Lang.isFunction(s.run)?e.Promise.reject("(flickr-collection::executeFetch) invalid fetcher for "+r.name+"["+i+"]"):(o=JSON.stringify(n),u=t[o],u?u:(t[o]=s.run.call(s,n,r.appContext).then(function(e){return delete t[o],e},function(e){throw delete t[o],e}),t[o]))},e.FlickrCollection.trimArray=function(e){var t,n=e.length;e=e.concat();if(!e[0]){t=0;while(t<n&&!e[t++]);t===n?e=[]:e=e.slice(t-1)}t=e.length;if(!e[t]){while(t>0&&!e[--t]);e=e.slice(0,t+1)}return e}},"@VERSION@",{requires:[]});
YUI.add("paged-collection",function(e){function t(t){var n={page:1,perPage:0,pageContent:[]};return t?(t instanceof Array&&(t={pageContent:t}),t=e.merge(n,t),t):(e.Flog.warn("No pageData sent to PagedCollection; aborting."),null)}e.PagedCollection=function(e,t,n,r){this.constructor.superclass.constructor.call(this,e,t,n),r&&(r instanceof Array&&(r={pageContent:r,page:1,perPage:r.length}),r.totalPages&&(this.totalPages=r.totalPages),r.totalItems&&(this.totalItems=r.totalItems),this.fetchedStart=!!r.fetchedStart,this.fetchedEnd=!!r.fetchedEnd,this.addPage(r))},e.extend(e.PagedCollection,e.FlickrCollection,{getPage:function(t){var n,r,i,s,o,u,a;if(!t||!t.page||!t.perPage||t.forceAPICall)t||(t={}),s=!0;else{u=this.totalPages&&t.page>=this.totalPages,a=this.totalItems&&r>=this.totalItems,n=t.perPage*(t.page-1),r=Math.min(t.perPage*t.page,this.totalItems);if(!u&&!a||!this.fetchedEnd)for(i=n;i<r;i++)if(typeof this._data[i]=="undefined"||!this._data[i].exists()){s=!0;break}}return s?(t.pathAlias||(t.id=this.id),t.isCollection=!0,o=this.registry.attributes[this.attrName].pageFetch,o.fetchParams&&(t=e.merge(t,o.fetchParams)),e.FlickrCollection.executeFetch(t,this.registry,this.attrName,o.listFetcher)):e.when(this._data.slice(n,r))},addPage:function(e){var t=e.perPage*(e.page-1),n=t+Math.min(e.pageContent.length,e.perPage),r,i=0;if(e.forceAppend)this._data=this._data.concat(e.pageContent);else if(this._data.length<=t)this._data.length=t,this._data=this._data.concat(e.pageContent);else{this._data.length<n&&(this._data.length=n);for(r=t;r<n;r++)this._data[r]=e.pageContent[i],i++}e.totalPages&&(this.totalPages=e.totalPages,e.page>=this.totalPages&&(this.fetchedEnd=!0)),e.totalItems&&(this.totalItems=e.totalItems,this._data.length>=e.totalItems?this.fetchedEnd=!0:t+parseInt(e.perPage,10)>e.totalItems&&this._data.length<e.totalItems&&(this.fetchedEnd=!0)),this.fetchedStart=this._data&&typeof this._data[0]!="undefined"},removePage:function(e){},getPageOf:function(t,n){n||(e.Flog.warn("`perPage` must be specified; defaulting to 50."),n=50);var r=this.find(t,!0);return r?Math.floor(r.index/n)+1:-1},getNextIncompletePage:function(e){var t=e.page*(e.perPage-1),n=Math.floor(this._data.length/e.perPage)+1;for(t;t<this._data.length;t++)if(typeof this._data[t]=="undefined"||!this._data[t].exists()){n=Math.floor(t/e.perPage)+1;break}return n},_setValue:function(e){if(e instanceof Array)this.constructor.superclass._setValue.call(this,e);else{e=t(e);if(!e)return;e.remove?this.removePage(e):this.addPage(e)}}})},"@VERSION@",{requires:["flickr-collection","flog"]});
YUI.add("flickr-model-registry",function(e){function n(t,n,s){return s===!1&&typeof t=="string"&&typeof n=="string"&&(t=t.toLowerCase(),n=n.toLowerCase()),t===n?!0:e.moment.isMoment(t)&&e.moment.isMoment(n)?t.diff(n)===0:e.Lang.isArray(t)&&e.Lang.isArray(n)&&r(t,n)?!0:e.Lang.isObject(t,!0)&&e.Lang.isObject(n,!0)&&i(t,n)?!0:!1}function r(t,r){var i=!0;return t.length!==r.length&&(i=!1),i&&e.Array.some(t,function(e,t){if(!n(r[t],e))return i=!1,!0}),i}function i(t,r){var i=!0;return e.Object.size(t)!==e.Object.size(r)&&(i=!1),i&&e.Object.some(t,function(e,t){if(!r.hasOwnProperty(t)||!n(r[t],e))return i=!1,!0}),i&&e.Object.some(r,function(e,r){if(!t.hasOwnProperty(r)||!n(t[r],e))return i=!1,!0}),i}function s(t){var n=t;return typeof t=="object"&&t!==null&&(Object.getPrototypeOf(t)===Array.prototype?(n=t.slice(),typeof t.hasMinBoundary!="undefined"&&(n.hasMinBoundary=t.hasMinBoundary),typeof t.hasMaxBoundary!="undefined"&&(n.hasMaxBoundary=t.hasMaxBoundary)):Object.getPrototypeOf(t)===Object.prototype&&(n={},e.Object.each(t,function(e,t){n[t]=e},this))),n}e.Models={};var t=e.FlickrModelRegistry=function(t){this.appContext=t,this.attributes=this.attributes||{},this.attributes.id={writeOnce:"initOnly",setter:function(t){return e.Lang.isString(t)||(e.Lang.isNumber(t)?t+="":(e.Flog.warn("`id` falling back to a Y.guid",t,this.name),t=e.guid())),t}},this._setDefaultRemoteMethods(),this._validateAttributes(),this._data={},this._dataSize=0,this._subscribers=[],this.hasWeakSubscribers=!1,this._chainedEvents={},this._derivedCache=undefined,this._unsavedModels={}};t.prototype={attributeSearch:function(t,r){var i=[];return t.id?i.push(t.id):e.Object.each(this._data,function(s,o){var u=!0;e.Object.some(t,function(e,t){if(!n(e,s[t],!1)){if(r!==!0)return u=!1,!0;if(!n(e,this.getDefaultValue(s.id,t),!1))return u=!1,!0}},this),u&&i.push(o)},this),i},load:function(t,n){var r=this,i,s;return n||(n={}),e.Lang.isObject(t,!0)?(i=this.attributeSearch(t).sort()[0],n=e.merge(t,n||{})):(i=t,n=e.merge({id:i},n)),i&&this.exists(i)?e.when(i):(this._fetchPromises||(this._fetchPromises={}),s=i||JSON.stringify(n),this._fetchPromises[s]?this._fetchPromises[s]:(this._fetchPromises[s]=this.remoteRead(n).then(function(){var e=i,n,o;i||(n=r.attributeSearch(t),n.length>0&&(e=n[0])),delete r._fetchPromises[s];if(e&&r.exists(e))return e;throw o=new Error("["+r.name+"] Model ID is missing after fetching."),o.getModelFailure=!0,o}),this._fetchPromises[s]))},get:function(e,t){return this.load(e,t).then(this.proxy.bind(this))},add:function(t,n,r){var i;if(!e.Lang.isObject(t,!0)||e.Lang.isArray(t)){e.Flog.warn("`add` requires an object",this.name,t);return}return typeof n=="undefined"&&(n=!1),i=this.attributes.id.setter.apply(this,[t.id,undefined]),this._data[i]?e.Flog.warn("Attempt to add a model that is already in the registry.",this.name,i):(this._data[i]={},this._dataSize++,this._queueEvent("modelsAdded",{id:i}),n?this._data[i]=t:Object.keys(this.attributes).forEach(function(e){var n=this.attributes[e],s=t[e];n.readOnly||this.setValue(i,e,s,!0,r)},this),this.appContext.markAsNewlyFetched(this.name,i)),this.proxy(i)},remove:function(e){if(!this.exists(e))return;delete this._data[e],this._dataSize--,this._removeChainedEvents(e),this._removeEventSubscribers(e),this._queueEvent("modelsRemoved",{id:e})},removeAll:function(){e.Object.each(this._data,function(e,t){this.remove(t)},this)},removeAllExcept:function(t){var n=t.reduce(function(e,t){return e[t]=!0,e},{});e.Object.each(this._data,function(e,t){n[t]||this.remove(t)},this)},_removeChainedEvents:function(t){var n;this._chainedEvents[t]&&(e.Object.each(this._chainedEvents[t],function(t,r){n=this.attributes[r],n&&(n.isModel?t.detach():(n.isListProxy||n.isCollection)&&e.Array.each(t,function(e){e.detach&&e.detach()}))},this),delete this._chainedEvents[t])},_removeEventSubscribers:function(t){var n=[];this._subscribers.length&&(e.Array.each(this._subscribers,function(e,r){e.id===t&&n.push(r)},this),e.Array.each(n,function(e){this._subscribers.splice(e,1)},this))},proxy:function(t){return this._ModelProxy||(this._ModelProxy=e.getModelProxyConstructor(this)),new this._ModelProxy(t)},getValue:function(t,n,r){var i,o,u;if(!t||!n){e.Flog.warn("`getValue` requires two arguments.",this.name,t,n);return}if(!this.exists(t)){e.Flog.warn("`getValue` called for an id that doesn't exist in the registry.",this.name,t,n);return}o=this.attributes[n];if(!o){e.Flog.warn("`getValue` called for an attribute that isn't defined: `"+n+"`.",this.name,t,n);return}return o.isListProxy?i=new e.ListProxy(this,t,n):(i=this._data[t][n],typeof i=="undefined"&&(i=this.getDefaultValue(t,n)),u=o.getter,!r&&u&&(i=u.apply(this,[i,t])),i=s(i)),i},setValue:function(t,r,i,o,u){var a,f,l,c,h,p,d;if(!t||!r||arguments.length<3){e.Flog.warn("`setValue` requires three arguments.",this.name,t);return}if(!this.exists(t)){e.Flog.warn("`setValue called for an id that is not in the registry.",this.name,t);return}a=this.attributes[r];if(!a){e.Flog.warn("Attribute `"+r+"` is not present in the attributes list.",this.name,t);return}if(a.readOnly){e.Flog.warn("Attribute `"+r+"` is readOnly.",this.name,t);return}if(a.writeOnce==="initOnly"&&!o){e.Flog.warn("Attribute `"+r+"` can only be set during initialization.",this.name,t);return}if(a.writeOnce===!0&&this._data[t][r]){e.Flog.warn("Attribute `"+r+"` can only be set once.",this.name,t);return}l=this.getValue(t,r),c=this._data[t][r],a.isListProxy&&(l=c);if(!u&&a.validator){p=a.validator;if(!e.Lang.isFunction(p)){e.Flog.warn("Attribute `"+r+"` has an invalid validator.",this.name,a.validator);return}if(!p.apply(this,[i,t])){e.Flog.info("Attribute `"+r+"` validation failed.",this.name,t,i);return}}i=s(i),!u&&a.setter&&(i=a.setter.apply(this,[i,t])),a.isListProxy&&!e.Lang.isArray(i)&&(i=[]),a.isCollection&&(i?typeof i=="object"&&i instanceof e.PagedCollection||(l?(c=l.getList(),l._setValue(i),i=l):(c=null,i=new e.PagedCollection(this,t,r,i))):i=new e.PagedCollection(this,t,r));if(!this._isDifferentValue
(t,r,i,l)){!o;return}if(a.isModel)if(!e.Lang.isObject(i)||!i.isModel){e.Flog.warn("Attribute `"+r+"` must be a ModelProxy instance.",this.name,t);return}o||(f=this._getAttributeValuesDerivedBy(t,r)),this._data[t][r]=i,a.isListProxy&&i&&(i.hasMinBoundary&&this.getValue(t,r).setMinBoundary(),i.hasMaxBoundary&&this.getValue(t,r).setMaxBoundary()),(a.isModel||a.isListProxy||a.isCollection)&&this._chainEvents(t,r),o||(h=this.getValue(t,r),!a.isListProxy&&!a.isCollection&&this._setUnsaved(t,r,h,l,c),d={id:t,attrName:r,prevVal:l,newVal:h},a.isListProxy?d.listDiff=this._calcListDiff(h,l):a.isCollection&&(d.listDiff=this._calcListDiff(h,c)),this._queueEvent("valuesChanged",d),e.Object.size(f)&&e.Object.each(f,function(e,i){var s=this.getValue(t,i);if(!n(s,e)){d={id:t,attrName:i,prevVal:e,newVal:s,derivedBy:[r]};if(this.attributes[i].isListProxy||this.attributes[i].isCollection)d.listDiff=this._calcListDiff(s,e);this._queueEvent("valuesChanged",d)}},this))},setValues:function(t,n){var r={};e.Object.each(n,function(e,n){n!=="id"&&(r[n]=this.setValue(t,n,e))},this)},revertValue:function(e,t){this._unsavedModels[e]&&typeof this._unsavedModels[e][t]!="undefined"&&this.setValue(e,t,this._unsavedModels[e][t].lastSavedValRaw)},exists:function(t){var n;return e.Lang.isArray(t)?n=t[0]:e.Lang.isObject(t,!0)?n=this.attributeSearch(t)[0]:n=t,!!this._data[n]},addOrUpdate:function(e){if(this.exists(e.id)){var t,n;Object.keys(e).forEach(function(r){t=this.attributes[r],n=e[r],t&&!t.readOnly&&t.writeOnce!=="initOnly"&&this.setValue(e.id,r,n)},this)}else this.add(e);return this.appContext.markAsNewlyFetched(this.name,e.id),this.markChildModelsAsNewlyFetched(e.id),this.proxy(e.id)},markChildModelsAsNewlyFetched:function(e){var t=this.getOwnedModels(e),n=this;t.forEach(function(e){e&&(n.appContext.markAsNewlyFetched(e.registry.name,e.id),e.markChildModelsAsNewlyFetched(e.id))})},getOwnedModels:function(t){var n,r,i=[],s;if(!t)return e.Flog.warn("`getOwnedModels` requires a model id.",this.name,t),i;if(!this.exists(t))return i;this._ModelProxy||(this._ModelProxy=e.getModelProxyConstructor(this));for(n in this.attributes){r=this.attributes[n];if(r.isModel)s=this.getValue(t,n),s&&s.exists()&&i.push(s);else if(r.isListProxy||r.isCollection)i=i.concat(this.getValue(t,n).getList().filter(function(e){return e&&e.isModel&&e.exists()}))}return i},hasAttribute:function(e){return!!this.attributes[e]},toJSON:function(e){var t={},n,r;if(e)for(n in this.attributes)t[n]=this.getValue(e,n),t[n]&&(this.attributes[n].isModel||this.attributes[n].isListProxy||this.attributes[n].isCollection)&&(t[n]=t[n].toJSON());else for(r in this._data)t[r]=this.toJSON(r);return t},on:function(t,n,r,i){var s;return t||(t=null),s={eventName:n,fn:r,id:t,weak:i},this._subscribers.push(s),i&&(this.hasWeakSubscribers=!0),{detach:function(){var t=e.Array.indexOf(this._subscribers,s);this._subscribers.splice(t,1)}.bind(this)}},removeWeakSubscribers:function(){var e=this._subscribers.length;if(e)while(e--)this._subscribers[e].weak&&this._subscribers.splice(e,1);this.hasWeakSubscribers=!1},getCount:function(){return this._dataSize},getDefaultValue:function(e,t){var n,r;return n=this.attributes[t],typeof n.defaultFn=="function"&&(r=n.defaultFn.call(this,e)),typeof r=="undefined"&&typeof n.defaultValue!="undefined"&&(r=n.defaultValue),r},_isDifferentValue:function(e,t,r,i){var s=this.attributes[t],o=s.getter;o&&(r=o.apply(this,[r,e]));if(typeof s.isListProxy!="undefined"&&s.isListProxy&&typeof i!="undefined"){if(r.hasMaxBoundary!==(typeof i.hasMaxBoundary!="undefined"&&i.hasMaxBoundary)||r.hasMinBoundary!==(typeof i.hasMinBoundary!="undefined"&&i.hasMinBoundary))return!0}else if(s.isCollection)return!0;return n(r,i)?!1:!0},_calcListDiff:function(t,n){var r,i,s,o,u={added:null,removed:null};return t instanceof e.ListProxy||t instanceof e.PagedCollection?r=t.getList():r=t,n instanceof e.ListProxy||n instanceof e.PagedCollection?i=n.getList():i=n,s=i.reduce(function(e,t){return t&&t.id&&(e[t.id]=!0),e},{}),o=r.reduce(function(e,t){return t&&t.id&&(e[t.id]=!0),e},{}),u.added=r.filter(function(e){return e&&!s[e.id]}),u.removed=i.filter(function(e){return e&&!o[e.id]}),u},_getAttributesDerivedBy:function(t){return this._derivedCache||(this._derivedCache={},e.Object.each(this.attributes,function(t,n){t.derivedBy&&e.Lang.isArray(t.derivedBy)&&e.Array.each(t.derivedBy,function(e){this._derivedCache[e]||(this._derivedCache[e]=[]),this._derivedCache[e].push(n)},this)},this)),this._derivedCache[t]},_getAttributeValuesDerivedBy:function(t,n){var r=this._getAttributesDerivedBy(n),i={};return r&&r.length&&e.Array.each(r,function(e){i[e]=this.getValue(t,e)},this),i},_queueEvent:function(t,n){var r;this._eventQueue||(this._eventQueue=[]),r=this._eventQueue,r.push({type:t,data:n}),this._eventPending||(this._eventPending=!0,setTimeout(function(){var t={};this._eventPending=!1,delete this._eventQueue,e.Array.each(r,function(e){var n=e.type,r=e.data,i=r.id;switch(n){case"modelsAdded":case"modelsRemoved":t[n]=t[n]||{},t[n][i]=r;break;case"valuesChanged":if(t.valuesChanged&&t.valuesChanged[i]&&t.valuesChanged[i][r.attrName]&&t.valuesChanged[i][r.attrName].newVal){t.valuesChanged[i][r.attrName].newVal=r.newVal,t.valuesChanged[i][r.attrName].derivedBy&&r.derivedBy&&(t.valuesChanged[i][r.attrName].derivedBy=t.valuesChanged[i][r.attrName].derivedBy.concat(r.derivedBy)),t.valuesChanged[i][r.attrName].chained&&!r.chained&&delete t.valuesChanged[i][r.attrName].chained;break}t.valuesChanged=t.valuesChanged||{},t.valuesChanged[i]=t.valuesChanged[i]||{},t.valuesChanged[i][r.attrName]=r}}),e.Object.each(t,function(e,t){this._fireEvent(t,e)},this)}.bind(this),0))},_fireEvent:function(t,n){e.Array.each(this._subscribers,function(e){e.eventName===t&&(e.id?n[e.id]&&e.fn.call(undefined,n[e.id]):e.fn.call(undefined,n))})},_chainEvents:function(t,n){var r=this.attributes[n],i,s;this._chainedEvents[t]=this._chainedEvents[t]||{};if(r.isModel)this._chainedEvents[t][n]&&this._chainedEvents[t][n].detach(),s=
this.getValue(t,n),this._chainedEvents[t][n]=s.on("valuesChanged",function(e){this._queueChainedEvent(t,n)}.bind(this));else if(r.isListProxy||r.isCollection)this._chainedEvents[t][n]&&e.Array.each(this._chainedEvents[t][n],function(e){e.detach()}),this._chainedEvents[t][n]=[],i=this.getValue(t,n),e.Array.each(i.getList(),function(e){e&&this._chainedEvents[t][n].push(e.on("valuesChanged",function(e){this._queueChainedEvent(t,n)}.bind(this)))},this)},_queueChainedEvent:function(t,n){var r=this.getValue(t,n),i;this._queueEvent("valuesChanged",{id:t,attrName:n,prevVal:r,newVal:r,chained:!0}),i=this._getAttributeValuesDerivedBy(t,n),e.Object.size(i)&&e.Object.each(i,function(e,r){this._queueEvent("valuesChanged",{id:t,attrName:r,newVal:e,derivedBy:[n],chained:!0})},this)},_deleteUnsaved:function(t,n){this._unsavedModels[t]&&this._unsavedModels[t][n]&&(delete this._unsavedModels[t][n],e.Object.size(this._unsavedModels[t])===0&&delete this._unsavedModels[t])},_setUnsaved:function(e,t,r,i,s){this._unsavedModels[e]&&this._unsavedModels[e][t]?n(r,this._unsavedModels[e][t].lastSavedVal)&&this._deleteUnsaved(e,t):(this._unsavedModels[e]=this._unsavedModels[e]||{},this._unsavedModels[e][t]={lastSavedVal:i,lastSavedValRaw:s})},_validateAttributes:function(){var t,n;t=["setter","getter","validator","defaultValue","defaultFn","derivedBy","readOnly","writeOnce","isModel","serialize","deserialize"],n=["isListProxy","isCollection","pageFetch","contextFetch","rangeFetch"],e.Object.each(this.attributes,function(r,i){e.Object.each(r,function(s,o){r.isListProxy||r.isCollection?e.Array.indexOf(n,o)===-1&&e.Flog.warn("Unknown property `"+o+"` on collection attribute `"+i+"`",this.name):e.Array.indexOf(t,o)===-1&&e.Flog.warn("Unknown property `"+o+"` on attribute `"+i+"`",this.name)},this)},this)},_setDefaultRemoteMethods:function(){this.remote=this.remote||{},this.remote.create||(this.remote.create=function(t){return e.Flog.error("[flickr-model-registry] `remote.create` was called without being implemented.",this.name,t),e.Promise.reject()}),this.remote.read||(this.remote.read=function(t){Object.keys(this.attributes).some(function(e){var t=this.attributes[e];if(e!=="id"&&!t.readOnly&&!t.isListProxy&&!t.isCollection&&!t.defaultValue&&!t.defaultFn)return!0},this),typeof t!="object"&&(t={id:t});var n={id:t.id};return this.add(n),e.Promise.resolve(n)}),this.remote.update||(this.remote.update=function(t,n){return e.Flog.error("[flickr-model-registry] `remote.update` was called without being implemented.",this.name,arguments),e.Promise.reject()}),this.remote["delete"]||(this.remote["delete"]=function(t){return e.Flog.error("[flickr-model-registry] `remote.delete` was called without being implemented.",this.name,arguments),e.Promise.reject()})},remoteCreate:function(e){return this.remote.create.call(this,e)},remoteRead:function(e){return this.remote.read.call(this,e)},remoteUpdate:function(t){var n={},r=this;return this._unsavedModels[t]&&e.Object.each(this._unsavedModels[t],function(e,r){n[r]={newVal:this.getValue(t,r),prevVal:e.lastSavedVal}},this),e.Object.size(n)>0?this.remote.update.call(this,t,n).then(function(e){return r._unsavedModels={},e}):e.Promise.resolve()},remoteBatchUpdate:function(e,t){return this.remote.batchUpdate.call(this,e,t)},remoteDelete:function(e){var t=this;return this.remote["delete"].call(this,e).then(function(){t.remove(e)})},getListPageByContinuation:function(t,n){var r=this,i=r.appContext,s,o,u,a,f,l,c,h,p,d,v="0",m="-1",g=e.APIHelper.request.getRebootPhotoExtras();switch(r.name){case"photo-groups-models":s="group-pool-models",o="groups",u="flickr.photos.getGroups",a="groups.group",g+=","+e.APIHelper.request.getRebootGroupExtras();break;case"photo-sets-models":s="set-models",o="sets",u="flickr.photos.getSets",a="sets.set";break;case"photo-galleries-models":s="gallery-models",o="galleries",u="flickr.photos.getGalleries",a="galleries.gallery"}return u?r.exists(t)?(r.continuationKeys=r.continuationKeys||{},r.getMorePromises=r.getMorePromises||{},l=r.continuationKeys[t]||v,l===m?e.Promise.resolve({newItems:[],loadedAll:!0}):(l===v&&(n+=r.getValue(t,o).getList().length),f={photo_id:t,extras:g,primary_photo_extras:"url_sq, url_t, url_s, url_m",continuation:l,per_page:n},h=t+"_"+l,p=r.getMorePromises[h],p?p:(d={apiResponse:i.callAPI(u,f,!0),contextRegistry:i.getModelRegistry(s),personRegistry:i.getModelRegistry("person-models")},r.name==="photo-groups-models"&&(d.groupRegistry=i.getModelRegistry("group-models")),r.getMorePromises[h]=(new e.FlickrPromise(d)).then(function(n){var i=[],s=n.apiResponse,u=n.contextRegistry,f=n.personRegistry,l=n.groupRegistry,p,d,v;return d=a.split(".").reduce(function(t,n){return e.Lang.isObject(t)?t[n]:undefined},s),d&&(e.Array.each(d,function(t){e.APIHelper.response.addContextToRegistry(t,u,f,l),i.push(u.proxy(t.id))}),i.length&&(v=r.getValue(t,o).getList().map(function(e){return e.getValue("id")}),i=i.filter(function(e){return v.indexOf(e.getValue("id"))===-1}),i.length&&r.getValue(t,o).appendToListMulti(i))),c=s[o].continuation,typeof c=="undefined"?c=m:e.Lang.isNumber(c)&&(c+=""),p=c===m,r.continuationKeys[t]=c,delete r.getMorePromises[h],{newItems:i,loadedAll:p}},function(e){throw delete r.getMorePromises[h],e}),r.getMorePromises[h]))):e.Promise.reject("[api-helper] getListPageByContinuation was called for an ID that isn't in the registry: "+t):e.Promise.reject("[api-helper] getListPageByContinuation was called without an invalid registry type: "+r.name)},getBuriedValue:function(e,t){var n,r={};return n=this.getValue(e,t),n&&n.payload&&(r=n.payload),r},setBuriedValue:function(e,t,n,r){return this.setValue(e,t,{payload:n},r)}},e.mix(t.prototype,e.Localizable)},"@VERSION@",{requires:["flickr-promise","model-proxy","list-proxy","moment","paged-collection","localizable","flog"]});
YUI.add("curation-photomappings-model",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-licensing-curation-photomappings"].run(t,this.appContext)}},attributes:{status:{},ownerStatus:{},category:{},collection:{},useType:{},technical:{},legal:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-licensing-curation-photomappings-fetcher"]});
YUI.add("flickr-licensing-curation-photomappings-fetcher",function(e,t){"use strict";function n(e){var t={};return t}function r(e,t){var n,r,i,s,o,u,a,f,l,c=e[0];r=c.status?c.status.item:null,i=c.ownerStatus?c.ownerStatus:null,s=c.category?c.category.item:null,o=c.collection?c.collection.item:null,a=c.technical?c.technical.item:null,f=c.legal?c.legal.item:null,u=c.useType?c.useType.item:null,n={id:t.id,status:r,ownerStatus:i,category:s,collection:o,useType:u,technical:a,legal:f},l=e[1],l.addOrUpdate(n)}function i(n,r){var i=this;return e.Promise.all([r.callAPI("flickr.licensing.curation.getPhotoMappings",this._processParams(n)),r.getModelRegistry("curation-photomappings-model")]).then(function(e){return i._processResponse(e,n)},e.FetcherErrorLogger(t))}e.namespace("ListFetchers")["flickr-licensing-curation-photomappings"]={run:i,_processResponse:r,_processParams:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["curation-photomappings-model"]});
YUI.add("hermes-template-curator-tool-photo-metadata-form",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing;return s+='<div id="curator-photo-',(o=n.photoId)?o=o.call(t,{hash:{},data:i}):(o=t.photoId,o=typeof o===f?o.apply(t):o),s+=l(o)+'">\n	<div class="photo-preview">\n		<img src="',(o=n.imgUrl)?o=o.call(t,{hash:{},data:i}):(o=t.imgUrl,o=typeof o===f?o.apply(t):o),s+=l(o)+'" alt="" />\n	</div>\n	<div class="photo-metadata">\n		\n		<div class="category-collection">\n			<div class="category">\n				<label for="photo-category-',(o=n.photoId)?o=o.call(t,{hash:{},data:i}):(o=t.photoId,o=typeof o===f?o.apply(t):o),s+=l(o)+'">Category *</label>\n				<div class="field-wrapper">\n					<div class="selectbox">\n						<div class="select-fade"></div>\n						<div class="select-arrow"></div>\n						<select class="photo-category-select" id="photo-category-',(o=n.photoId)?o=o.call(t,{hash:{},data:i}):(o=t.photoId,o=typeof o===f?o.apply(t):o),s+=l(o)+'" name="photo-category-',(o=n.photoId)?o=o.call(t,{hash:{},data:i}):(o=t.photoId,o=typeof o===f?o.apply(t):o),s+=l(o)+"\" required><option value='0'>None</option>",a={hash:{},data:i},s+=l((o=n.renderTrustedMarkup||t.renderTrustedMarkup,o?o.call(t,t.categoryOptions,a):c.call(t,"renderTrustedMarkup",t.categoryOptions,a)))+'</select>\n					</div>\n				</div>\n			</div>\n			<div class="collection">\n				<label for="photo-collection-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'">Collection</label>\n				<div class="field-wrapper">\n					<div class="selectbox">\n						<div class="select-fade"></div>\n						<div class="select-arrow"></div>\n						<select class="photo-collection-select" id="photo-collection-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'" name="photo-collection-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{},data:i},s+=l((o=n.renderTrustedMarkup||t.renderTrustedMarkup,o?o.call(t,t.collectionOptions,a):c.call(t,"renderTrustedMarkup",t.collectionOptions,a)))+'</select>\n					</div>\n				</div>\n			</div>\n		</div>\n		\n		<div class="use-type-releases">\n			\n			<div class="use-type">\n				<label for="photo-use-type-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'">Use Type *</label>\n				<div class="field-wrapper">\n					<div class="selectbox">\n						<div class="select-fade"></div>\n						<div class="select-arrow"></div>\n						<select class="photo-use-type-select" id="photo-use-type-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'" name="photo-use-type-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+"\" required><option value='0'>None</option>",a={hash:{},data:i},s+=l((o=n.renderTrustedMarkup||t.renderTrustedMarkup,o?o.call(t,t.useTypeOptions,a):c.call(t,"renderTrustedMarkup",t.useTypeOptions,a)))+'</select>\n					</div>\n				</div>\n			</div>\n			<div class="model-releases">\n				<label for="photo-model-releases-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'">Model Releases</label>\n				<div class="field-wrapper">\n					<div class="selectbox">\n						<div class="select-fade"></div>\n						<div class="select-arrow"></div>\n						<select class="photo-model-releases-select" id="photo-model-releases-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'" name="photo-model-releases-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{},data:i},s+=l((o=n.renderTrustedMarkup||t.renderTrustedMarkup,o?o.call(t,t.modelReleasesOptions,a):c.call(t,"renderTrustedMarkup",t.modelReleasesOptions,a)))+'</select>\n					</div>\n				</div>\n			</div>\n			<div class="property-releases">\n				<label for="photo-property-releases-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'">Property Releases</label>\n				<div class="field-wrapper">\n					<div class="selectbox">\n						<div class="select-fade"></div>\n						<div class="select-arrow"></div>\n						<select class="photo-property-releases-select" id="photo-property-releases-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'" name="photo-property-releases-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{},data:i},s+=l((o=n.renderTrustedMarkup||t.renderTrustedMarkup,o?o.call(t,t.propertyReleasesOptions,a):c.call(t,"renderTrustedMarkup",t.propertyReleasesOptions,a)))+'</select>\n					</div>\n				</div>\n			</div>\n		</div>\n		\n		<div class="technical">\n			<label for="photo-technical-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'">Technical</label>\n			<div class="field-wrapper">\n				<div class="selectbox">\n					<div class="select-fade"></div>\n					<div class="select-arrow"></div>\n					<select class="photo-technical-select" id="photo-technical-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'" name="photo-technical-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'">',a={hash:{},data:i},s+=l((o=n.renderTrustedMarkup||t.renderTrustedMarkup,o?o.call(t,t.technicalOptions,a):c.call(t,"renderTrustedMarkup",t.technicalOptions,a)))+'</select>\n				</div>\n			</div>\n		</div>\n		\n		<div class="legal">\n			<label for="photo-legal-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'">Legal</label>\n			<div class="field-wrapper">\n				<div class="selectbox">\n					<div class="select-fade"></div>\n					<div class="select-arrow"></div>\n					<select class="photo-legal-select" id="photo-legal-'
,(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+'" name="photo-legal-',(u=n.photoId)?u=u.call(t,{hash:{},data:i}):(u=t.photoId,u=typeof u===f?u.apply(t):u),s+=l(u)+"\"><option value='0'>None</option>",a={hash:{},data:i},s+=l((o=n.renderTrustedMarkup||t.renderTrustedMarkup,o?o.call(t,t.legalOptions,a):c.call(t,"renderTrustedMarkup",t.legalOptions,a)))+"</select>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>\n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/curator-tool-photo-metadata-form",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-curator-control-panel",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function c(e,t){var r="",i;return r+="\n		<p>Photographer status: <strong>",(i=n.photographerStatus)?i=i.call(e,{hash:{},data:t}):(i=e.photographerStatus,i=typeof i===a?i.apply(e):i),r+=f(i)+'</strong></p>\n		<p>\n			<a href="/god/licensing/curation/editor_1/accounts/',(i=n.ownerId)?i=i.call(e,{hash:{},data:t}):(i=e.ownerId,i=typeof i===a?i.apply(e):i),r+=f(i)+'/">',(i=n.photographerStatusString)?i=i.call(e,{hash:{},data:t}):(i=e.photographerStatusString,i=typeof i===a?i.apply(e):i),r+=f(i)+"</a>\n		</p>\n	",r}function h(e,t){var r="",i,s;r+="\n		",i=n["if"].call(e,e.ownerLocked,{hash:{},inverse:l.program(6,d,t),fn:l.program(4,p,t),data:t});if(i||i===0)r+=i;r+='\n\n		<div id="curator-photo-status">\n		        <p>\n		                Photo status:\n		                <strong>\n		                    '+f((i=(i=e.children,i==null||i===!1?i:i.photoStatus),typeof i===a?i.apply(e):i))+'\n		                </strong>\n		        </p>\n		</div>\n\n		<div id="photographer-claimed-by">\n			 <p>Claimed by: '+f((i=(i=e.children,i==null||i===!1?i:i.photographerClaimedBy),typeof i===a?i.apply(e):i))+"</p>\n		</div>\n\n		",s=n["if"].call(e,(i=e.children,i==null||i===!1?i:i.ownerClaimedByMe),{hash:{},inverse:l.noop,fn:l.program(11,g,t),data:t});if(s||s===0)r+=s;return r+="\n	",r}function p(e,t){return"\n			<p>\n				LOCKED\n			</p>\n		"}function d(e,t){var r="",i;r+="\n			",i=n["if"].call(e,e.addPhotoButton,{hash:{},inverse:l.program(9,m,t),fn:l.program(7,v,t),data:t});if(i||i===0)r+=i;return r+="\n		",r}function v(e,t){return'\n				<button id="curator-photo-submit">\n					Add this photo\n				</button>\n			'}function m(e,t){var r="",i;return r+='\n				<p>\n					<a href="',(i=n.updateUrl)?i=i.call(e,{hash:{},data:t}):(i=e.updateUrl,i=typeof i===a?i.apply(e):i),r+=f(i)+'">',(i=n.updateString)?i=i.call(e,{hash:{},data:t}):(i=e.updateString,i=typeof i===a?i.apply(e):i),r+=f(i)+"</a>\n				</p>\n			",r}function g(e,t){var n="",r;return n+='\n			<div id="curator-photo-count">\n			        <p>\n			                Photo count: <strong>'+f((r=(r=e.children,r==null||r===!1?r:r.photosCount),typeof r===a?r.apply(e):r))+"</strong>\n			        </p>\n			</div>\n		",n}function y(e,t){return'\n	    <!--<img src="https://s.yimg.com/g/images/3mp.gif" alt=""/> -->\n	    <div id="photo-is-three-mp"></div>\n	'}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a="function",f=this.escapeExpression,l=this;s+='<div id="curator-control-panel">\n	',o=n.unless.call(t,t.ownerEnrolled,{hash:{},inverse:l.program(3,h,i),fn:l.program(1,c,i),data:i});if(o||o===0)s+=o;s+="\n\n	",u=n["if"].call(t,(o=t.children,o==null||o===!1?o:o.is3Megapixels),{hash:{},inverse:l.noop,fn:l.program(13,y,i),data:i});if(u||u===0)s+=u;return s+="\n	\n</div>\n \n",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/curator-control-panel",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("curator-photo-tools-view",function(e){e.namespace("Views")[this.name]=e.Base.create("curator-photo-tools-view",e.FlickrView,[],{initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.isModalOpen=!1,this.modal=null,this.photoStatusId=null,this.photoStatusMap=null,this.photoCount=0,this},subviewConfig:{},loadState:function(){var t=this,n;return n={curationPhotomappingsModel:this.appContext.getModel("curation-photomappings-model",this.nsid),photoModel:this.appContext.getModel("photo-models",this.photoId),nsid:this.nsid,photoStatus:this.getPhotoStatus()},(new e.FlickrPromise(n)).then(function(n){var r,i;t.curationPhotomappingsModel=n.curationPhotomappingsModel,t.photoStatusMap=t.curationPhotomappingsModel.getValue("status"),t.photographerStatusMap=t.curationPhotomappingsModel.getValue("owner_status"),t.photoModel=n.photoModel,t.photoStatusId=n.photoStatusId,t.photoStatusId=parseInt(n.photoStatus.status,10),t.is3Megapixels=n.photoStatus.is3Megapixels?!!n.photoStatus.is3Megapixels:!1,t.ownerAddedForCuration=n.photoStatus.ownerAddedForCuration?!!n.photoStatus.ownerAddedForCuration:!1,t.ownerEnrolled=n.photoStatus.ownerEnrolled?!!n.photoStatus.ownerEnrolled:!1,t.ownerLocked=n.photoStatus.ownerLocked?!!n.photoStatus.ownerLocked:!1,t.ownerClaimedByMe=n.photoStatus.ownerClaimedByMe?!!n.photoStatus.ownerClaimedByMe:!1,t.photoAddedForCuration=n.photoStatus.photoAddedForCuration?!!n.photoStatus.photoAddedForCuration:!1,t.ownerId=n.photoStatus.ownerId?n.photoStatus.ownerId:0,t.ownerStatusId=n.photoStatus.ownerStatus?n.photoStatus.ownerStatus:"None",t.photographerClaimedBy=n.photoStatus.ownerClaimedByByid?n.photoStatus.ownerClaimedByByid:"Who Knows?!",t.photographerStatus=n.photoStatus.ownerStatus?n.photoStatus.ownerStatus:"None",r=e.StorageHelper.getItem("curationPhotoCount_"+n.nsid),n.photoStatus.photosCount?(t.photosCount=n.photoStatus.photosCount,t.addPhotoCount(t.photosCount)):r?t.photosCount=r:t.photosCount=0,i=e.one("#curator-control-panel"),i&&i.remove(!0)},function(e){console.log("Error getting photomapping model or photo model",e)})},getPhotoStatus:function(){var e={photo_id:this.photoId,fetch_photos_count:this.getCountStatus()};return this.appContext.callAPI("flickr.licensing.curation.getPhotoStatus",e).then(function(e){return e.photos.photo.curation[0]},function(){console.error("Error calling API method: flickr.licensing.curation.getPhotoStatus",arguments)})},getCountStatus:function(){var t,n,r,i,s,o=!1,u=900;return i=Math.round((new Date).getTime()/1e3),n="curationPhotoCount_"+this.nsid,s="curationPhotoCountUpdateTime_"+this.nsid,r=e.StorageHelper.getItem(n),r||(o=!0),o||(t=parseInt(e.StorageHelper.getItem(s)),o=i-t>u),o},addPhotoCount:function(t){var n,r,i;return n="curationPhotoCount_"+this.nsid,r="curationPhotoCountUpdateTime_"+this.nsid,i=Math.round((new Date).getTime()/1e3),e.StorageHelper.setItem(r,i),e.StorageHelper.setItem(n,t),!0},buildContainer:function(){return this},activate:function(){var e,t=this;return e=this.appContext.getViewer().prefs.keyboardShortcutsEnabled,this.setupCuratorTools(),e&&this.registerEventHandler(this.attachKeyEvent("down:87",function(e){e.preventDefault(),t.handleAddPhotoClick(e)})),this},destructor:function(){e.one("#curator-control-panel")&&e.one("#curator-control-panel").remove(!0)},setupCuratorTools:function(){if(this.get("destroyed"))return;var t,n=this;e.Array.find(this.photoStatusMap,function(e){if(e.id===n.photoStatusId)return t=e.name,!0}),e.one("#content").appendChild(e.Node.create(this.templates("curator-control-panel")({ownerAddedForCuration:this.ownerAddedForCuration,photographerStatus:this.ownerAddedForCuration?this.photographerStatus:"none",photographerStatusString:this.ownerAddedForCuration?"Update this photographer":"Add this photographer",ownerId:this.ownerId,ownerEnrolled:this.ownerEnrolled,ownerLocked:this.ownerLocked,addPhotoButton:!this.photoAddedForCuration&&this.ownerClaimedByMe,photoClaimedByMe:this.ownerClaimedByMe&&this.photoAddedForCuration,updateUrl:this.ownerClaimedByMe&&this.photoAddedForCuration?"/god/licensing/curation/editor_2/accounts/"+this.ownerId+"/photos/":"/god/licensing/curation/editor_2/accounts/"+this.ownerId,updateString:this.ownerClaimedByMe&&this.photoAddedForCuration?"Update this photographer's photos":"Update this photographer",children:{ownerClaimedByMe:this.ownerClaimedByMe,photoAddedForCuration:this.photoAddedForCuration,photoStatus:this.photoAddedForCuration?t:"none",photosCount:this.photosCount,photographerClaimedBy:this.ownerClaimedByMe?"YOU!":this.photographerClaimedBy,is3Megapixels:this.is3Megapixels}}))),this.registerEventHandler(e.one("#curator-photo-submit").on("click",this.handleAddPhotoClick,this))},updateStatus:function(){var t,n=this;t={photo_id:this.photoId,fetch_photos_count:this.getCountStatus()},this.appContext.callAPI("flickr.licensing.curation.getPhotoStatus",t).then(function(t){var r,i,s=t.photos.photo.curation[0];n.photoStatusId=parseInt(s.status,10),n.is3Megapixels=s.is3Megapixels?!!s.is3Megapixels:!1,n.ownerAddedForCuration=s.ownerAddedForCuration?!!s.ownerAddedForCuration:!1,n.ownerEnrolled=s.ownerEnrolled?!!s.ownerEnrolled:!1,n.ownerLocked=s.ownerLocked?!!s.ownerLocked:!1,n.ownerClaimedByMe=s.ownerClaimedByMe?!!s.ownerClaimedByMe:!1,n.photoAddedForCuration=s.photoAddedForCuration?!!s.photoAddedForCuration:!1,n.ownerId=s.ownerId?s.ownerId:0,n.ownerStatusId=s.ownerStatus?s.ownerStatus:"None",n.photographerClaimedBy=s.ownerClaimedByByid?s.ownerClaimedByByid:"Who Knows?!",n.photographerStatus=s.ownerStatus?s.ownerStatus:"None",n.photosCount=s.photosCount?s.photosCount:0,r=e.StorageHelper.getItem("curationPhotoCount_"+n.nsid),s.photosCount?n.photosCount=s.photosCount:r?n.photosCount=parseInt(r,10)+1:n.photosCount=1,n.addPhotoCount(n.photosCount),i=e.one("#curator-control-panel"),i&&i.remove(!0),n.setupCuratorTools()})},handleAddPhotoClick:function(t){t.preventDefault();var n="",r=this;if(this.isModalOpen&&this.modal){this.modal.close(),this.isModalOpen=!1,this
.modal=null;return}n='<form id="curator-photo-selection-form">',n+=this.buildPhotoCurationForm(this.photoId,this.getImageUrl(this.photoModel)),n+="</form>",this.modal=(new e.Views.FluidModal({appContext:r.appContext,title:"Submit this photo",htmlMessage:n,width:840,height:600,dismissOnActionClick:!1})).show(),this.registerEventHandler(this.modal.on("activated",function(t){this.isModalOpen=!0,e.one("#curator-photo-selection-form .photo-category-select").focus()},this)),this.registerEventHandler(this.modal.on("actionClick",this.handlePhotoSubmission,this)),this.registerEventHandler(this.modal.on("cancelClick",function(e){this.isModalOpen=!1,this.modal=null},this))},buildPhotoCurationForm:function(e,t){var n;return this.photoFormState=this.getPhotoMetadata("curator-photo-form-state"),n=this.templates("curator-tool-photo-metadata-form")({categoryOptions:this.buildOptions("category"),collectionOptions:this.buildOptions("collection"),modelReleasesOptions:this.buildOptions("model-releases"),propertyReleasesOptions:this.buildOptions("property-releases"),technicalOptions:this.buildOptions("technical"),legalOptions:this.buildOptions("legal"),useTypeOptions:this.buildOptions("useType"),photoId:e,imgUrl:t}),n},buildOptions:function(t){var n="",r,i,s,o=this;if(this.photoFormState)try{s=e.JSON.parse(this.photoFormState)}catch(u){console.error("Error parsing JSON from local storage",u)}if(t==="model-releases"||t==="property-releases")for(r=0;r<=20;r++)n+='<option value="'+r+'">'+r+"</option>";else i=this.curationPhotomappingsModel.getValue(t),t==="technical"&&i.unshift({id:0,name:"None"}),e.Array.each(i,function(e){if(t==="technical")if(o.is3Megapixels)switch(parseInt(e.id,10)){case 4:case 5:case 6:case 7:case 9:return}else switch(parseInt(e.id,10)){case 0:case 1:case 2:case 3:case 9:return}if(t==="collection"&&e.name==="Flickr Prime (RM)")return;t==="category"||t==="collection"?s&&s[t]&&parseInt(s[t],10)===e.id?n+='<option value="'+e.id+'" selected>'+e.name+"</option>":n+='<option value="'+e.id+'">'+e.name+"</option>":n+='<option value="'+e.id+'">'+e.name+"</option>"});return n},getImageUrl:function(e){var t=e.getValue("ascendingSizes"),n=Math.min(5,t.length-1);return t[n].url},handlePhotoSubmission:function(t){var n,r,i=this.photoId,s,o=this;n={photos:{photo:[]}},r=e.one("#curator-photo-selection-form");if(!r)return;r.one(".photo-use-type-select").removeClass("error"),r.one(".photo-category-select").removeClass("error"),(r.one(".photo-category-select").get("value")===""||r.one(".photo-category-select").get("value")==="0")&&r.one(".photo-category-select").addClass("error"),(r.one(".photo-use-type-select").get("value")===""||r.one(".photo-use-type-select").get("value")==="0")&&r.one(".photo-use-type-select").addClass("error");if(r.one(".photo-category-select").get("value")===""||r.one(".photo-category-select").get("value")==="0"||r.one(".photo-use-type-select").get("value")===""||r.one(".photo-use-type-select").get("value")==="0")return!1;n.photos.photo.push({id:i,category:r.one(".photo-category-select").get("value"),collection:r.one(".photo-collection-select").get("value"),model_releases:r.one(".photo-model-releases-select").get("value"),property_releases:r.one(".photo-property-releases-select").get("value"),technical_review:r.one(".photo-technical-select").get("value"),legal_review:r.one(".photo-legal-select").get("value"),use_type:r.one(".photo-use-type-select").get("value")}),s={category:r.one(".photo-category-select").get("value"),collection:r.one(".photo-collection-select").get("value")},window&&window.localStorage&&window.localStorage.clear&&e.Object.some(window.localStorage,function(e,t){return t.indexOf("curator-photo-metadata")>-1?(window.localStorage.clear(),!0):!1}),this.savePhotoMetadata("curator-photo-form-state",e.JSON.stringify(s)),n.photos.photo.length>0&&this.appContext.callAPI("flickr.licensing.curation.addPhotos",{json:e.JSON.stringify(n)}).then(function(){o.isModalOpen=!1,o.modal.close(),o.updateStatus(),o.modal=null},function(){o.isModalOpen=!1,o.modal.close(),o.modal=null,console.error("flickr.licensing.curation.addPhotos error",arguments)})},savePhotoMetadata:function(t,n){try{return e.StorageHelper.setItem(t,n),!0}catch(r){return!1}},getPhotoMetadata:function(t){try{return e.StorageHelper.getItem(t)}catch(n){return!1}}},{ATTRS:{}})},"@VERSION@",{requires:["flutil","flickr-view","flickr-promise","fluid-modal-view","fluid-css","products-form-css","products-new-payment-form-css","curator-tools-css","curation-photomappings-model","hermes-template-curator-tool-photo-metadata-form","hermes-template-curator-control-panel"],optional:[]});
/*
YUI 3.16.0 (build 76f0e08)
Copyright 2014 Yahoo! Inc. All rights reserved.
Licensed under the BSD License.
http://yuilibrary.com/license/
*/

YUI.add("yui-throttle",function(e,t){
/*! Based on work by Simon Willison: http://gist.github.com/292562 */
;e.throttle=function(t,n){n=n?n:e.config.throttleTime||150;if(n===-1)return function(){t.apply(this,arguments)};var r=e.Lang.now();return function(){var i=e.Lang.now();i-r>n&&(r=i,t.apply(this,arguments))}}},"3.16.0",{requires:["yui-base"]});
YUI.add("hermes-template-photo-well-scrappy",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function p(e,t){return" enable-zoom"}function d(e,t){return" no-click"}function v(e,t){return" is-hidden"}function m(e,t){var r;return(r=n["prev-url"])?r=r.call(e,{hash:{},data:t}):(r=e["prev-url"],r=typeof r===f?r.apply(e):r),l(r)}function g(e,t){return"#"}function y(e,t){var r;return(r=n["prev-title"])?r=r.call(e,{hash:{},data:t}):(r=e["prev-title"],r=typeof r===f?r.apply(e):r),l(r)}function b(e,t){var r;return(r=n["next-url"])?r=r.call(e,{hash:{},data:t}):(r=e["next-url"],r=typeof r===f?r.apply(e):r),l(r)}function w(e,t){var r;return(r=n["next-title"])?r=r.call(e,{hash:{},data:t}):(r=e["next-title"],r=typeof r===f?r.apply(e):r),l(r)}function E(e,t){var r="",i,s;return r+="\n		",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-sidebar-toggle-view"],s):c.call(e,"outlet",e["photo-sidebar-toggle-view"],s)))+"\n		",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-title-desc-overlay-view"],s):c.call(e,"outlet",e["photo-title-desc-overlay-view"],s)))+"\n		",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-sidebar-actions-view"],s):c.call(e,"outlet",e["photo-sidebar-actions-view"],s)))+"\n		",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["attribution-view"],s):c.call(e,"outlet",e["attribution-view"],s)))+"\n		",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["people-notes-view"],s):c.call(e,"outlet",e["people-notes-view"],s)))+"\n		",s={hash:{},data:t},r+=l((i=n.outlet||e.outlet,i?i.call(e,e["photo-engagement-view"],s):c.call(e,"outlet",e["photo-engagement-view"],s)))+"\n	",r}function S(e,t){var r="",i;return r+="\n		<a class='entry-type do-not-evict' href='",(i=n.entryURL)?i=i.call(e,{hash:{},data:t}):(i=e.entryURL,i=typeof i===f?i.apply(e):i),r+=l(i)+"'>",(i=n.backToLabel)?i=i.call(e,{hash:{},data:t}):(i=e.backToLabel,i=typeof i===f?i.apply(e):i),r+=l(i)+"</a>\n	",r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u,a,f="function",l=this.escapeExpression,c=n.helperMissing,h=this;s+='<div class="height-controller',o=n["if"].call(t,t.enableZoom,{hash:{},inverse:h.noop,fn:h.program(1,p,i),data:i});if(o||o===0)s+=o;s+='" style="height: ',(o=n.height)?o=o.call(t,{hash:{},data:i}):(o=t.height,o=typeof o===f?o.apply(t):o),s+=l(o)+'px;">\n\n	<a class="navigate-target navigate-prev',o=n["if"].call(t,t["prev-is-not-clickable"],{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(o||o===0)s+=o;o=n["if"].call(t,t["is-hidden"],{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(o||o===0)s+=o;s+='" href="',o=n["if"].call(t,t["prev-url"],{hash:{},inverse:h.program(9,g,i),fn:h.program(7,m,i),data:i});if(o||o===0)s+=o;s+='" title="',o=n["if"].call(t,t["prev-url"],{hash:{},inverse:h.noop,fn:h.program(11,y,i),data:i});if(o||o===0)s+=o;s+='" data-track="prevPhotoButtonClick" data-action="ad" style="height: ',(o=n.navHeight)?o=o.call(t,{hash:{},data:i}):(o=t.navHeight,o=typeof o===f?o.apply(t):o),s+=l(o)+'px;"><span class="hide-text">&larr;</span></a>\n\n	',a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["photo-well-media-view"],a):c.call(t,"outlet",t["photo-well-media-view"],a)))+"\n	",a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["photo-notes-scrappy-view"],a):c.call(t,"outlet",t["photo-notes-scrappy-view"],a)))+'\n\n	<a class="navigate-target navigate-next',u=n["if"].call(t,t["next-is-not-clickable"],{hash:{},inverse:h.noop,fn:h.program(3,d,i),data:i});if(u||u===0)s+=u;u=n["if"].call(t,t["is-hidden"],{hash:{},inverse:h.noop,fn:h.program(5,v,i),data:i});if(u||u===0)s+=u;s+='" href="',u=n["if"].call(t,t["next-url"],{hash:{},inverse:h.program(9,g,i),fn:h.program(13,b,i),data:i});if(u||u===0)s+=u;s+='"  title="',u=n["if"].call(t,t["next-url"],{hash:{},inverse:h.noop,fn:h.program(15,w,i),data:i});if(u||u===0)s+=u;s+='" data-track="nextPhotoButtonClick" data-action="ad" style="height: ',(u=n.navHeight)?u=u.call(t,{hash:{},data:i}):(u=t.navHeight,u=typeof u===f?u.apply(t):u),s+=l(u)+'px;"><span class="hide-text">&rarr;</span></a>\n\n	',u=n.unless.call(t,t["is-ad"],{hash:{},inverse:h.noop,fn:h.program(17,E,i),data:i});if(u||u===0)s+=u;s+="\n\n	",u=n.unless.call(t,t.hideBackToLink,{hash:{},inverse:h.noop,fn:h.program(19,S,i),data:i});if(u||u===0)s+=u;return s+="\n\n	",a={hash:{},data:i},s+=l((o=n.outlet||t.outlet,o?o.call(t,t["context-slider-view"],a):c.call(t,"outlet",t["context-slider-view"],a)))+"\n\n</div>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-well-scrappy",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-photo-page-right-size-express",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression;return s+='\n\n<script type="text/javascript">\n\n	\n	(function(){\n\n		\n		var PADDING_HORIZONTAL = 40;\n\n		\n		window.getPhotoWellHeight = function () {\n\n			var minHeight = 500,\n			    winWidth = window.innerWidth,\n			    \n			    winHeight = window.innerHeight - 50,\n			    ratioNarrow = 1,\n			    ratioRegular = 2.3,\n			    ratioTransitional = 2.75,\n			    idealSubphotoHeight = 120,\n			    breakHeightNarrow = (winWidth / ratioNarrow) + idealSubphotoHeight,\n			    breakHeightRegular = (winWidth / ratioRegular) + idealSubphotoHeight,\n			    breakHeightTransitional = winWidth / ratioTransitional,\n			    newPhotoWellHeight;\n\n			\n			if (winHeight > breakHeightNarrow) {\n\n				newPhotoWellHeight = winWidth / ratioNarrow;\n\n			\n			} else if (winHeight > breakHeightRegular) {\n\n				newPhotoWellHeight = winHeight - idealSubphotoHeight;\n\n			\n			} else if (winHeight > breakHeightTransitional) {\n\n				newPhotoWellHeight = winHeight - idealSubphotoHeight + idealSubphotoHeight * (winHeight - breakHeightRegular) / (breakHeightTransitional - breakHeightRegular);\n\n			\n			} else {\n\n				newPhotoWellHeight = winHeight;\n\n			}\n\n			\n			return Math.max(minHeight, Math.round(newPhotoWellHeight));\n\n		}\n\n		\n		function domReady () {\n\n			\n			try {\n\n				\n				if (document.getElementsByClassName("low-res-photo")[0]) {\n\n					var photoWellView = document.getElementsByClassName("photo-well-scrappy-view")[0],\n					    heightController = photoWellView.getElementsByClassName("height-controller")[0],\n					    photoWellMediaView = document.getElementsByClassName("photo-well-media-scrappy-view")[0],\n					    lowResImageElement = photoWellMediaView.getElementsByClassName("low-res-photo")[0],\n					    photoWidth = ',(o=n.photoWidth)?o=o.call(t,{hash:{},data:i}):(o=t.photoWidth,o=typeof o===u?o.apply(t):o),s+=a(o)+",\n					    photoHeight = ",(o=n.photoHeight)?o=o.call(t,{hash:{},data:i}):(o=t.photoHeight,o=typeof o===u?o.apply(t):o),s+=a(o)+",\n					    photoAspectRatio = photoWidth / photoHeight,\n					    photoWellHeight = window.getPhotoWellHeight(),\n					    photoWellMediaViewPadding = {\n					        top: parseInt(getComputedStyle(photoWellMediaView)['paddingTop'].match(/[0-9]+/)[0], 10),\n					        right: PADDING_HORIZONTAL,\n					        bottom: parseInt(getComputedStyle(photoWellMediaView)['paddingBottom'].match(/[0-9]+/)[0], 10),\n					        left: PADDING_HORIZONTAL\n					    },\n					    canvasSize = {\n					        height: photoWellHeight - photoWellMediaViewPadding.top - photoWellMediaViewPadding.bottom,\n					        width: window.innerWidth - photoWellMediaViewPadding.left - photoWellMediaViewPadding.right\n					    };\n\n					"+'\n					heightController.style.height = photoWellHeight + "px";\n\n					'+'\n					if (photoWidth <= canvasSize.width && photoHeight <= canvasSize.height) {\n						lowResImageElement.style.height = photoHeight + "px";\n						lowResImageElement.style.width = photoWidth + "px";\n					} else {\n						'+"\n						if (photoAspectRatio < 1 || Math.round(canvasSize.width / photoAspectRatio) > canvasSize.height) {\n							"+'\n							lowResImageElement.style.height = canvasSize.height + "px";\n							lowResImageElement.style.width = Math.round(canvasSize.height * photoAspectRatio) + "px";\n						} else {\n							'+'\n							lowResImageElement.style.height = Math.round(canvasSize.width / photoAspectRatio) + "px";\n							lowResImageElement.style.width = canvasSize.width + "px";\n						}\n					}\n\n				}\n\n			} catch (e) {\n				'+"\n				if (window.sendRequest) {\n					window.sendRequest('flickr.hermes.photoDimensionCorrectionError', 'There was a JS error when trying to correct a server rendered photo.');\n				}\n			}\n\n		}\n\n		"+"\n		if (document.readyState != 'loading'){\n			domReady();\n		} else {\n			document.addEventListener('DOMContentLoaded', domReady);\n		}\n\n	}());\n\n</script>",s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-page-right-size-express",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("flickr-video-player",function(e){var t={playlistUrl:e.url("/video_playlist.gne",{protocol:!1}),lang:e.config.lang,comscoreC4:"",defaultResolution:"1080p",atlas:{maxBitrate:4e3,domain:"video.yahoo.com"},css:{processing:"processing"},messages:{processing:"This video is being processed"}};e.FlickrVideoPlayer=function(e){this.container=e.container,this.model=e.model,this.appContext=e.appContext,this.currentStream=null},e.FlickrVideoPlayer.prototype={render:function(){var n,r,i=this;this.setCurrentStream(t.defaultResolution,"noop"),i.appContext.flipper.isFlipped("enable-nextgen-videoplayer")?n={playlist:{mediaItems:[{images:i.getThumbnails(),streams:[{url:this.currentStream.url}]}]},pageSpaceId:this.appContext.flapp.get("activeView").get("spaceid").toString(),comscoreC4:"flickr",settingscreen:!1,pausescreen:!1,html5:i.appContext.flipper.isFlipped("enable-html5-videoplayer")?!0:!1}:(n={playlist:{mediaItems:[]},pageSpaceId:this.appContext.flapp.get("activeView").get("spaceid"),comscoreC4:t.comscoreC4,lang:t.lang,autoplay:!1},n.playlist.mediaItems.push(this.toMediaItem(this.currentStream))),n.region="US",n.site="flickr",this.player=new e.VideoPlatform.VideoPlayer(n),this.player.render(this.container),r=e.VideoPlatform.API_Events,this.player.on(r.PLAYER_RENDERED,function(e){var t=i.container.one(".yvp-html5-video");i.appContext.flipper.isFlipped("enable-nextgen-videoplayer")&&t&&t.on("contextmenu",function(e){return e.preventDefault(),!1})}),this.player.on(r.PLAYER_ERROR,function(t){var n;i.appContext.flipper.isFlipped("enable-nextgen-videoplayer")?n=i.container.one(".yvp-content"):n=i.container.one(".yui3-videoplayer-content"),e.Flog.error("[video-player] "+t.type+": "+(t.message||"no message"));if(i.__retry){n.removeClass("retrying");return}i.__retry=!0,n.addClass("retrying"),i.loadStreams().then(function(){i.setCurrentStream(i.currentStream.resolution),i.play()})}),this.player.on(r.PLAYBACK_ERROR,function(t){e.Flog.error("[video-player] "+t.type+": "+(t.message||"no message"))})},hasHdStream:function(){return this.streams["1080p"]||this.streams["720p"]||this.streams.appletv},isHdStream:function(e){return["1080p","720p","appletv"].indexOf(this.currentStream.resolution)>=0},play:function(){this.player.controls.play()},pause:function(){this.player.controls.pause()},resize:function(e,t){this.container.setStyles({width:e+"px",height:t+"px"})},setCurrentStream:function(e,t){this.currentStream&&this.quality&&this.quality.removeClass("q"+this.currentStream.resolution),this.currentStream=this.getStream(e),this.quality&&this.quality.addClass("q"+this.currentStream.resolution);if(t)return;this.player.playlist.clear(),this.player.playlist.addItem(this.toMediaItem(this.currentStream)),this.player.playlist.setPosition(0)},toMediaItem:function(e){return{streamUrl:e.url,images:this.getThumbnails()}},init:function(){var t,n=this;return t=new e.FlickrPromise({script:this.loadScript(),streams:this.loadStreams(),domLive:this._waitDomLive()}),t.then(function(e){n.render()})},_waitDomLive:function(){var t=this.container.getDOMNode().parentElement;return new e.Promise(function(e,n){var r=50,i;i=function(){var n=t.parentElement;while(n&&n!==document.body)n=n.parentElement;if(n)return e();if(r--<0)return;setTimeout(i,100)},i()})},getStream:function(e){var t,n,r;t=["1080p","720p","appletv","360p","700","300","100","iphone_wifi","288p"],e&&(r=t.indexOf(e),t=r>0?t.slice(r):t);while(t.length){n=this.streams[t.shift()];if(n)return n}return{}},getThumbnails:function(){var e,t;return t={width:parseInt(this.container.getComputedStyle("width"),10)||800,height:parseInt(this.container.getComputedStyle("height"),10)||600},e=this.model.getSizeToFit(t,{excludeSizes:[]}),{large:e.url,medium:e.url,small:e.url}},loadScript:function(){var n=this;return new e.Promise(function(r,i){var s,o;if(e.VideoPlatform){r();return}o=function(){e.use("videoplayer",r)},n.appContext.flipper.isFlipped("enable-nextgen-videoplayer")?(t.yepSourceUrl="//yep.video.yahoo.com/js/3/videoplayer-min.js?r=nextgen-flash",t.yepMobileSourceUrl="//yep.video.yahoo.com/js/3/videoplayer-min.js?r=nextgen"):t.yepSourceUrl="//yep.video.yahoo.com/js/3/videoplayer-min.js?lang="+t.lang,s=document.createElement("script"),s.onload=o,e.UA&&e.UA.mobile&&t.yepMobileSourceUrl?s.src=t.yepMobileSourceUrl:s.src=t.yepSourceUrl,document.head.appendChild(s)})},loadStreams:function(){var t=this;return new e.Promise(function(n,r){var i;i={photo_id:t.model.getValue("id"),secret:t.model.getValue("secret")},t.appContext.callAPI("flickr.video.getStreamInfo",i).then(function(r){try{t.streams=r.streams.stream.reduce(function(e,t){var n=t.type+"";return e[n]={resolution:n,url:t.content},e},{})}catch(i){t.streams={}}Object.keys(t.streams).length||e.Flog.error("[video-player] no streams available"),n()},function(n){if(n&&n.code&&n.code.toString()==="1")return t.setProcessing();e.Flog.error("[video-player] error fetching playlist")})})},loadXmlStreams:function(){var n=this;return new e.Promise(function(r,i){var s,o;s={nsid:n.model.getValue("owner").getValue("nsid"),video_id:n.model.getValue("id"),bitrate:t.atlas.maxBitrate,secret:n.model.getValue("secret"),rd:t.atlas.domain,noad:1},o=new XMLHttpRequest,o.open("GET",e.flutil.buildHttpQuery(t.playlistUrl,s)),o.onload=function(){var t,i,s;t=document.createElement("div"),t.innerHTML=o.responseText,s=t.getElementsByTagName("duration")[0],s=s?parseInt(s.textContent,10):0,i=Array.prototype.slice.call(t.getElementsByTagName("stream")),n.streams=i.reduce(function(e,t){var n=Array.prototype.reduce.call(t.attributes,function(e,t){return e[t.name]=t.value,e},{});return n.url=n.app+n.fullpath,n.resolution=(n.path.match(/_([^\.\_]+)\./)||[])[1],n.duration=s,e[n.resolution]=n,e},{}),Object.keys(n.streams).length||e.Flog.error("[video-player] no streams available"),r()},o.onerror=function(){e.Flog.error('[video-player] error fetching playlist XML "'+e.flutil.buildHttpQuery(t.playlistUrl,s)+'"')},o.send()})},_cleanup:function(e){e=e.getDOMNode();var t=function(
e){if(!e.firstChild)return;while(e.firstChild)t(e.firstChild),e.removeChild(e.firstChild)};t(e)},setProcessing:function(){var t=e.Node.create("<img/>");t.set("src",this.getThumbnails().large),this.container.appendChild(t)},destroy:function(){try{this.player&&this.player.destroy(),this.player=null,this.quality&&this.quality.detach(),this.quality=null,this._cleanup(this.container),this.container=null,this.model=null,this.appContext=null,this.streams=null}catch(e){}}}},"@VERSION@",{requires:["flickr-promise","flog","flutil","flickr-video-player-css","url"],optional:[]});
YUI.add("hermes-template-zoom",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{}}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/zoom",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("hermes-template-zoom-modal",function(e,t){var n=e.Template.Handlebars.revive(function(e,t,n,r,i){function l(e,t){var r="",i;return r+='<img src="',(i=n.smallSrc)?i=i.call(e,{hash:{},data:t}):(i=e.smallSrc,i=typeof i===u?i.apply(e):i),r+=a(i)+'" class="zoom-small">',r}function c(e,t){var r="",i;return r+='<img src="',(i=n.largeSrc)?i=i.call(e,{hash:{},data:t}):(i=e.largeSrc,i=typeof i===u?i.apply(e):i),r+=a(i)+'" class="zoom-large">',r}this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),i=i||{};var s="",o,u="function",a=this.escapeExpression,f=this;s+='<div class="zoom-modal hidden">\n	<div class="zoom-photo-container">\n		',o=n["if"].call(t,t.smallSrc,{hash:{},inverse:f.noop,fn:f.program(1,l,i),data:i});if(o||o===0)s+=o;s+="\n		",o=n["if"].call(t,t.largeSrc,{hash:{},inverse:f.noop,fn:f.program(3,c,i),data:i});if(o||o===0)s+=o;return s+='\n		<span class="facade-of-protection-zoom"></span>\n	</div>\n</div>\n',s}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/zoom-modal",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("animation-manager",function(e){e.AnimationManager=function(){function i(){return n=!1,r=[],!YUI.Env.isServer&&!e.config.win.requestAnimationFrame&&s(),{subscribe:u}}function s(){var t=["webkit","moz"],n,r,i=0;for(r=0;r<t.length&&!e.config.win.requestAnimationFrame;++r)n=t[r],e.config.win.requestAnimationFrame=e.config.win[n+"RequestAnimationFrame"],e.config.win.cancelAnimationFrame=e.config.win[n+"CancelAnimationFrame"]||e.config.win[n+"CancelRequestAnimationFrame"];if(!e.config.win.requestAnimationFrame||!e.config.win.cancelAnimationFrame)e.config.win.requestAnimationFrame=function(e){var t=Date.now(),n=Math.max(i+16,t);return setTimeout(function(){e(i=n)},n-t)},e.config.win.cancelAnimationFrame=clearTimeout}function o(){if(!n)return;r.forEach(function(e,t){e()}),e.config.win.requestAnimationFrame(o)}function u(t){return r.push(t),n||(n=!0,e.config.win.requestAnimationFrame(o)),{detach:function(){r.splice(r.indexOf(t),1),r.length||(n=!1)}}}var t,n,r;return t||(t=i()),t}()},"@VERSION@",{requires:[]});
YUI.add("flickr-favorites-add-updater",function(e,t){"use strict";function n(n,r){var i={};return i.photo_id=n.photoId,r.callAPI("flickr.favorites.add",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-favorites-add"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("flickr-favorites-remove-updater",function(e,t){"use strict";function n(n,r){var i={};return i.photo_id=n.photoId,i.user_id=n.userId,r.callAPI("flickr.favorites.remove",i).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-favorites-remove"]={run:n}},"@VERSION@",{requires:["flickr-promise"],optional:[]});
YUI.add("photo-model-helper",function(e){e.PhotoModelHelper={updateEngagement:function(t,n){var r=[],i;return e.Lang.isObject(n,!0)&&"isFaved"in n&&(i=n.isFaved.newVal?"flickr-favorites-add":"flickr-favorites-remove",r.push(e.ModelUpdaters[i].run({photoId:t},this.appContext))),e.Promise.all(r)},toggleFave:function(e){var t=this.getValue(e,"faveCount"),n=this.getValue(e,"isFaved"),r=!n,i="photo-engagement-models",s=t+(r?1:-1);this.setValues(e,{isFaved:r,faveCount:s}),this.name!==i&&this.appContext.getModelRegistry(i).then(function(t){t.exists(e)&&t.toggleFave(e)})},addAsFave:function(e){var t=this.getValue(e,"faveCount"),n=this.getValue(e,"isFaved"),r="photo-engagement-models";return n||this.setValues(e,{isFaved:!0,faveCount:t+1}),this.name!==r&&this.appContext.getModelRegistry(r).then(function(t){t.exists(e)&&t.toggleFave(e)}),!n},getLargestSize:function(e,t){return this.getSizeToFit(e,{width:Number.MAX_VALUE,height:Number.MAX_VALUE},t)},getSizeToFit:function(t,n,r){r=r||{};var i=this,s,o=n.width,u=n.height,a=!!r.cropToFit,f=r.includeSquare,l=r.sizes||this.getValue(t,"sizes"),c=r.excludeSizes||["o"],h=r.includeSizes,p,d,v;if(typeof r.includeSizes=="undefined")try{h=Object.keys(l)}catch(m){e.Flog.warn("[photo-model-helper] getSizeToFit with invalid sizes:",l)}return this._getSizeToFitMemo=this._getSizeToFitMemo||{},s=[t,o,u,a,c.sort().join(""),h.sort().join("")].join("_"),this._getSizeToFitMemo[s]||(e.Object.each(l,function(e,n){var r,i,s,l,m,g;if(e&&c.indexOf(n)===-1&&h.indexOf(n)>-1)if(f||!this.isSizeSquare(n)||this.isPhotoSquare(t)){r=parseInt(e.width,10),i=parseInt(e.height,10),a&&r>=o&&i>=u?s=!0:!a&&(r>=o||i>=u)&&(s=!0),s&&(p?(l=parseInt(p.height,10),i<l&&(p=e)):p=e);if(d){m=parseInt(d.width,10),g=parseInt(d.height,10);if(r>m||i>g)d=e}else d=e}v=p||d},this),this._getSizeToFitMemo[s]=v,this._getSizeToFitMemoTimer||(this._getSizeToFitMemoTimer=setTimeout(function(){delete i._getSizeToFitMemo,delete i._getSizeToFitMemoTimer},1e4))),e.clone(this._getSizeToFitMemo[s],!0)},getSizeIfExact:function(e,t){var n=this.getValue(e,"sizes"),r,i;return Object.keys(n).some(function(e){return e==="o"?!1:(i=n[e],t.height===i.height&&t.width===i.width?(r=i,!0):!1)}),r},isSizeSquare:function(e){var t={sq:"sq",q:"q"};return!!t[e]},isPhotoSquare:function(t){var n;return this._isPhotoSquareMemo=this._isPhotoSquareMemo||{},typeof this._isPhotoSquareMemo[t]!="undefined"?n=this._isPhotoSquareMemo[t]:(n=!0,e.Object.some(this.getValue(t,"sizes"),function(e,t){var r;if(e&&e.width&&e.height&&!this.isSizeSquare(t)){r=parseInt(e.width,10)/parseInt(e.height,10);if(r!==1)return n=!1,!0}},this),this._isPhotoSquareMemo[t]=n),n},attributes:{title:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},mediaType:{validator:function(t,n){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:"photo"},license:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},isVideo:{readOnly:!0,derivedBy:["mediaType"],getter:function(e,t){var n=this.getValue(t,"mediaType");return n==="video"}},isOwner:{readOnly:!0,derivedBy:["owner"],getter:function(e,t){var n=this.getValue(t,"owner"),r=this.appContext.getViewer();return!!r.signedIn&&n.getValue("id")===r.nsid}},sizes:{},descendingSizes:{readOnly:!0,derivedBy:["sizes"],defaultFn:function(e){var t,n,r=[];this._descendingSizesMemo=this._descendingSizesMemo||{};if(this._descendingSizesMemo[e])return this._descendingSizesMemo[e];t=this.getValue(e,"sizes");for(n in t)r.push(t[n]),r[r.length-1].key=n;return r.sort(function(e,t){return e.width<t.width?1:e.width===t.width?e.height<t.height?1:e.height===t.height?e.key==="o"?-1:1:-1:-1}),this._descendingSizesMemo[e]=r,r}},ascendingSizes:{readOnly:!0,derivedBy:["descendingSizes"],defaultFn:function(e){return this.getValue(e,"descendingSizes").reverse()}},aspectRatio:{readOnly:!0,derivedBy:["descendingSizes","rotation"],defaultFn:function(e){var t=this.getValue(e,"descendingSizes")[0];return t.key==="o"&&this.getValue(e,"rotation")%180!==0?t.height/t.width:t.width/t.height}},needsInterstitial:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},canComment:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!0},url:{readOnly:!0,derivedBy:["owner"],defaultFn:function(e){var t=this.getValue(e,"owner");return t?"/photos/"+t.getValue("pathAlias")+"/"+e:undefined}},rotation:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)}},ownerNsid:{},isFaved:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},faveCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return t=e.AttributeHelpers.coerceInteger(t),t<0&&(t=0),t},defaultValue:0},commentCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return t=e.AttributeHelpers.coerceInteger(t),t<0&&(t=0),t},defaultValue:0},canFave:{readOnly:!0,derivedBy:["is_owner"],getter:function(e,t){return!this.getValue(t,"isOwner")}},is3MP:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},ownerCountryApproved:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},ownerFollowedByCurators:{validator:function(t){return e
.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},ownerAdded:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},ownerPassedOver:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},statusColor:{defaultValue:""},isMarketplaceLicensable:{defaultFn:function(e){return!1}},marketplaceLicensingUrl:{setter:function(e){return e.indexOf("http")<0&&(e="http://"+e),e},defaultFn:function(e){return""}}}}},"@VERSION@",{requires:["flickr-favorites-add-updater","flickr-favorites-remove-updater"]});
YUI.add("flickr-licensing-curation-passOverUser-updater",function(e,t){"use strict";function n(n,r){return r.callAPI("flickr.licensing.curation.passOverUser",n).then(null,e.FetcherErrorLogger(t))}e.namespace("ModelUpdaters")["flickr-licensing-curation-passOverUser"]={run:n}},"@VERSION@",{requires:["flickr-promise"]});
YUI.add("photo-curation-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext)}},attributes:{is3MP:e.PhotoModelHelper.attributes.is3MP,ownerCountryApproved:e.PhotoModelHelper.attributes.ownerCountryApproved,ownerFollowedByCurators:e.PhotoModelHelper.attributes.ownerFollowedByCurators,ownerAdded:e.PhotoModelHelper.attributes.ownerAdded,ownerPassedOver:e.PhotoModelHelper.attributes.ownerPassedOver,statusColor:e.PhotoModelHelper.attributes.statusColor}})},"@VERSION@",{requires:["flickr-model-registry","flickr-licensing-curation-passOverUser-updater","attribute-helpers"]});
YUI.add("flickr-photos-geo-setLocation-updater",function(e,t){"use strict";e.namespace("ModelUpdaters")["flickr-photos-geo-setLocation"]={run:function(n,r){return r.callAPI("flickr.photos.geo.setLocation",n).then(null,e.FetcherErrorLogger(t))}}},"@VERSION@");
YUI.add("photo-location-models",function(e){function t(e){t.superclass.constructor.call(this,e)}t.SUPPORTED_WOE_LEVELS=["neighbourhood","locality","county","region","country","continent"],e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-photos-getInfo"].run(t,this.appContext).then(function(e){return e},function(){})}},attributes:{geo:{isModel:!0},hasGeo:{readOnly:!0,derivedBy:["geo"],defaultFn:function(e){var t=this.getValue(e,"geo");return t?t.getValue("hasGeo"):!1}},latitude:{readOnly:!0,derivedBy:["geo"],defaultFn:function(e){var t=this.getValue(e,"geo");return t?t.getValue("latitude"):null}},longitude:{readOnly:!0,derivedBy:["geo"],defaultFn:function(e){var t=this.getValue(e,"geo");return t?t.getValue("longitude"):null}},levels:{},text:{},mostSpecificWoeId:{readOnly:!0,derivedBy:["levels"],defaultFn:function(e){var n=this.getValue(e,"levels"),r;return t.SUPPORTED_WOE_LEVELS.some(function(e){if(n[e]&&n[e].woeId)return r=n[e].woeId,!0}),r}},mostSpecificLevelIndex:{readOnly:!0,derivedBy:["levels"],defaultFn:function(e){var n=this.getValue(e,"levels"),r;return t.SUPPORTED_WOE_LEVELS.some(function(e,t){if(n[e]&&n[e].woeId)return r=t,!0}),r}},staticMaps:{}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-photos-getInfo-fetcher","attribute-helpers"]});
YUI.add("flickr-photos-getLocation-fetcher",function(e,t){"use strict";function n(t,n){var i=t.photo||{},s=i.location||null,o,u=i.staticMaps&&i.staticMaps.staticMap||null,a=i.venues?i.venues.venue:null,f,l=[];return f={id:i.id,levels:{}},s?(o={id:i.id,hasGeo:!0,latitude:s.latitude,longitude:s.longitude,accuracy:s.accuracy},e.Models["photo-location-models"].SUPPORTED_WOE_LEVELS.forEach(function(e){if(!s[e])return;f.levels[e]={name:s[e].content||null,woeId:s[e].woeid||null}}),i.geoperms&&(o.isPublic=i.geoperms.ispublic,o.isContact=i.geoperms.iscontact,o.isFriend=i.geoperms.isfriend,o.isFamily=i.geoperms.isfamily)):o={id:i.id,hasGeo:!1},f.geo=n.addOrUpdate(o),a&&(f.levels.venue={name:a.content||a.address||null,woeId:a.woe_id,source:a.source,venueId:a.id,venueLat:a.latitude,venueLong:a.longitude},a.content&&l.push(a.content),a.city&&l.push(a.city),a.country&&l.push(a.country),f.text=l.join(", ")),f.text||(f.text=r(f.levels)),e.Lang.isArray(u)&&(f.staticMaps={},u.forEach(function(e){f.staticMaps["zoom"+e.zoom]=e})),f}function r(e){var t=[],n,r,i;n=[["venue","locality","region"],["neighbourhood","locality","region"],["locality","region","country"],["county","region","country"]];while(n.length&&t.length<3){r=n.shift(),t=[];while(r.length&&t.length<3)i=r.shift(),e[i]&&e[i].name&&t.push(e[i].name)}return t.join(", ")}function i(n,r){var i=n.id,s={photo_id:i,extras:"venue"},o=this;return e.APIHelper.request.addStaticMapsParams(s),e.Promise.all([r.callAPI("flickr.photos.geo.getLocation",s),r.getModelRegistry("photo-location-models"),r.getModelRegistry("photo-geo-models")]).then(function(e){var t=e[0],n=e[1],r=e[2],i=o.mapResponse(t,r);return n.addOrUpdate(i),i},e.FetcherErrorLogger(t))}e.namespace("ModelFetchers")["flickr-photos-getLocation"]={run:i,mapResponse:n}},"@VERSION@",{requires:["flickr-promise","api-helper"],optional:["photo-geo-models","photo-location-models"]});
